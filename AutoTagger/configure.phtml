<?php
// Define categories directly in template
$categories = [
    'dealTerms' => 'Deal Terms',
    'shoppingEvents' => 'Shopping Events',
    'urgencyTerms' => 'Urgency Terms',
    'promotionalCodes' => 'Promotional Codes',
    'callToAction' => 'Call to Action',
    'affiliateMarkers' => 'Affiliate Markers',
    'discountPatterns' => 'Discount Patterns',
];

$conf = FreshRSS_Context::userConf();
?>

<form action="<?php echo _url('extension', 'configure', 'e', urlencode($this->getName())); ?>" method="post">
	<input type="hidden" name="_csrf" value="<?php echo FreshRSS_Auth::csrfToken(); ?>" />
	<p class="group-description">
		Enter one regular expression pattern per line. Patterns are matched case-insensitively against article titles and content.
		If a pattern matches, the article is tagged with the label of the group it belongs to.
	</p>
	
	<?php foreach ($categories as $categoryKey => $categoryLabel) {
		$key = 'autotagger_patterns_' . $categoryKey;
		$patterns = $conf->attributeString($key, '');
		$fieldName = 'autotagger_' . $categoryKey;
	?>
	<div class="form-group">
		<label class="group-name" for="<?php echo htmlspecialchars($fieldName, ENT_QUOTES, 'UTF-8'); ?>"><?php echo htmlspecialchars($categoryLabel, ENT_NOQUOTES, 'UTF-8'); ?></label>
		<div class="group-controls">
			<textarea
				id="<?php echo htmlspecialchars($fieldName, ENT_QUOTES, 'UTF-8'); ?>"
				name="<?php echo htmlspecialchars($fieldName, ENT_QUOTES, 'UTF-8'); ?>"
				rows="8"
				class="w100"
				placeholder="Enter one regex pattern per line&#10;Example:&#10;(best|lowest|exclusive) (deal|price|offer)"><?php echo htmlspecialchars($patterns, ENT_NOQUOTES, 'UTF-8'); ?></textarea>
		</div>
	</div>
	<?php } ?>

	<div class="form-group form-actions">
		<div class="group-controls">
			<button type="submit" class="btn btn-important"><?php echo _t('gen.action.submit'); ?></button>
			<button type="reset" class="btn"><?php echo _t('gen.action.cancel'); ?></button>
		</div>
	</div>
</form>

<div class="callout info">
	<p>
		<strong>How it works:</strong> When new articles are imported, this extension checks the article title and content against your regex patterns.
		If a pattern matches, the article is automatically tagged with the corresponding label.
		You can then filter or organize articles by these labels in FreshRSS.
	</p>
	<p>
		<strong>Regex tips:</strong>
	</p>
	<ul>
		<li>Patterns are case-insensitive by default</li>
		<li>Use <code>(word1|word2)</code> to match either word1 or word2</li>
		<li>Use <code>word.?word</code> to match "word word" or "word-word" (optional character)</li>
		<li>Use <code>\d+</code> to match numbers</li>
		<li>Use <code>\$</code> to match a dollar sign (escape special characters)</li>
	</ul>
</div>
